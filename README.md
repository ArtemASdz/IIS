<h1>Описание проекта</h1>
<p>Этот набор данных содержит медицинские данные, используемые для прогнозирования сердечных заболеваний. Данные включают в себя различные атрибуты, такие как возраст, пол, тип боли в груди (cp), кровяное давление в покое (trestbps), холестерин (хол), уровень сахара в крови натощак (fBS), результаты электрокардиографии в покое (receg), максимальная частота сердечных сокращений (талах), ангина, вызванная физическими упражнениями (экспанг), и ST-депрессия, вызванная физическими упражнениями.Ссылка на исходную выборку данных: https://www.kaggle.com/datasets/krishujeniya/heart-diseae</p>
<h1>Запуск проекта</h1>
<p>Для запуска проекта необходимо выполнить следующие команды:<br>git clone https://github.com/ArtemASdz/IIS.git<br># Установка окружения<br> ```python3 -m venv .venv_my_proj```<br># Активация окружения <br> ```source .venv_my_proj/bin/activate```<br># Установка зависимостей <br> ```(.venv_my_proj) mainuser@Ubuntu: ~$ pip install requirements.txt```</p>
<h1>Исследование данных</h1>
<p>Программа находится в ./eda/eda.ipynb. Основные результаты:<br>В ходе исследования были проведены действия:</p>
<h2>Предобработка данных</h2>
<ul>
    <li>Удалены дубликаты записей</li>
    <li>Проверены и проанализированы выбросы в числовых признаках</li>
    <li>Удалены строки с пропущенными значениями</li>
    <li>Проверены столбцы на валидность - данные не противоречивы</li>
    <li>Для столбцов 'sex', 'cp', 'fbs', 'restecg', 'exang', 'slope', 'ca', 'thal' подтвержден корректный тип данных категориальных признаков</li>
    <li>Для числовых признаков 'age', 'trestbps', 'chol', 'thalach', 'oldpeak' проверены границы значений</li>
</ul>
<h2>Создание новых признаков</h2>
<ul>
    <li>Был сформирован новый признак age_group - возрастная категория (1: молодой, 2: средний, 3: пожилой, 4: старческий)</li>
    <li>Был сформирован новый признак high_chol - бинарный показатель высокого холестерина (>240 мг/дл)</li>
    <li>Был сформирован новый признак relative_heart_rate - относительный пульс (максимальный пульс / возраст)</li>
    <li>Был сформирован новый признак atypical_pain - наличие атипичной боли в груди</li>
    <li>Был сформирован новый признак significant_oldpeak - значительная депрессия ST после упражнений (>1.0)</li>
</ul>
<h1>В ходе анализа были выявлены следующие закономерности:</h1>
<p><b>Распределение целевой переменной</b> (см график ./eda/target_distribution.png)<br>Наблюдается сбалансированность классов: примерно равное количество случаев с заболеванием сердца (1) и без (0)</p>
<p><b>Возрастное распределение</b> (см график ./eda/age_distribution.png)<br>Люди с заболеванием сердца в среднем старше (пик заболеваемости 55-65 лет)<br>После 70 лет количество случаев уменьшается</p>
<p><b>Корреляция признаков</b> (см график ./eda/correlation_matrix.png)<br>Наибольшую положительную корреляцию с целевой переменной имеет признак thalach (максимальный пульс)<br>Отрицательная корреляция наблюдается у признаков: exang (стенокардия), oldpeak (депрессия ST), age</p>
<p><b>Уровень холестерина</b> (см график ./eda/chol_by_sex.png)<br>У мужчин с заболеванием сердца в среднем более высокий уровень холестерина<br>У женщин распределение холестерина более однородное между группами</p>
<p><b>Взаимосвязь возраста и пульса</b> (см график ./eda/age_vs_thalach.png)<br>Четкая отрицательная корреляция между возрастом и максимальным пульсом<br>Люди без заболевания сердца имеют в среднем более низкий максимальный пульс</p>
<p><b>Обзор взаимосвязей </b> (см график ../eda/pairplot.png)<br>Наблюдается хорошая разделимость классов в многомерном пространстве признаков<br>Видны четкие кластеры и закономерности в данных</p>
<p>Обработанная выборка сохранена в файл ./data/heart-disease-cleaned.pkl</p>

<h1>Запуск MLFlow</h1>
<p>Для отслеживания экспериментов и управления моделями используется MLFlow.<br> 
# Расположение скрипта: ./mlflow/start_mlflow.sh <br>
# Команда для запуска: <br>
```sh start_mlflow.sh```</p>
<p><b>Доступ к интерфейсу:</b><br> http://localhost:5001<br>
Скрипт запускает MLFlow сервер с SQLite бэкендом для хранения метрик и артефактов.</p>
<h1>Результаты исследования</h1>
<h2>Лучшая модель</h2>
<p>В ходе экспериментов наилучший результат показала модель RandomForest с отбором признаков.</p>
<p><b>Метрики качества:</b></p>
<ul>
    <li>F1-Score: 0.8415</li>
    <li>Accuracy: 0.8289</li>
    <li>ROC-AUC: 0.9013</li>
    <li>Precision: 0.8462</li>
    <li>Recall: 0.8367</li>
</ul>
<p><b>Гиперпараметры модели:</b></p>
<ul>
    <li>n_estimators: 150</li>
    <li>max_depth: 15</li>
    <li>max_features: 0.7</li>
    <li>random_state: 42</li>
</ul>
<p><b>Выбранные признаки:</b></p>
<ul>
    <li>age, trestbps, chol, thalach, oldpeak (числовые)</li>
    <li>sex, cp, fbs, restecg, exang, slope, thal (категориальные)</li>
    <li>age_group (новый признак)</li>
</ul>
<p><b>Production модель:</b></p>
<ul>
    <li>Run ID: 06e7ec5721f94aceb33c7a308d4d2f32</li>
    <li>Название прогона: Best_Model_Feature_Selection_Production</li>
    <li>Зарегистрирована как: HeartDiseasePredictor версия 5</li>
    <li><b>Тэг:</b> stage=Production</li>
</ul>
<p>Модель обучена на полной выборке и готова к использованию</p>
<h1>ML Service для предсказания сердечных заболеваний</h1>
<h2>Описание сервиса</h2>
<p>Сервис машинного обучения для предсказания вероятности сердечных заболеваний на основе медицинских параметров пациента. Реализован как REST API сервис с использованием FastAPI.</p>
<h1>Структура папки ml_service</h1>
<p>__pycache__/           # Кэш-папка Python (автогенерируемая)<br>
├── __init__.py            # Пакетный файл Python <br>
├── api_handler.py         # Обработчики API endpoints и маршрутизация <br>
├── Dockerfile             # Конфигурация Docker образа <br>
├── main.py                # Основной файл FastAPI приложения <br>
└── requirements.txt       # Зависимости Python</p>
<h1>Структура папки models</h1>
<p>models/
├── __pycache__/           # Кэш-папка Python (автогенерируемая)<br>
├── __init__.py            # Пакетный файл Python<br>
├── get_model.py           # Логика загрузки и управления моделями<br>
└── model.pkl              # Сохраненная модель машинного обучения</p>
<h1>Установка и запуск</h1>
<h2>1. Сборка Docker образа</h2>
<p># Перейдите в папку сервиса <br>
cd ~/my_proj/services/ml_service<br>
sudo docker build -t heart-disease-predictor:1 .</p>
<h2>2. Запуск контейнера</h2>
<p>#  Запустите контейнер с пробросом портов <br>
sudo docker run -p 8001:8000 -v $(pwd)/../models:/models heart-disease-predictor:1</p>
<p>Сервис будет доступен по адресу: http://localhost:8001</p>
<h1>Проверка работоспособности</h1>
<h2>1. Проверка статуса сервиса</h2>
<p># Проверка здоровья сервиса<br>
curl http://localhost:8001/<br>
curl http://localhost:8001/api/model_status</p>
<h2>2. Пример предсказания</h2>
<p>URL: POST http://localhost:8001/api/prediction?item_id=1</p>
<p>Тело запроса (JSON):</p>
<p>{
  "age": 52,
  "sex": 1,
  "cp": 0,
  "trestbps": 125,
  "chol": 212,
  "fbs": 0,
  "restecg": 1,
  "thalach": 168,
  "exang": 0,
  "oldpeak": 1.0,
  "slope": 2,
  "ca": 2,
  "thal": 3
}</p>
<p>Пример выполнения через curl:</p>
<p>curl -X POST "http://localhost:8001/api/prediction?item_id=1" \
     -H "Content-Type: application/json" \
     -d '{
       "age": 52,
       "sex": 1,
       "cp": 0,
       "trestbps": 125,
       "chol": 212,
       "fbs": 0,
       "restecg": 1,
       "thalach": 168,
       "exang": 0,
       "oldpeak": 1.0,
       "slope": 2,
       "ca": 2,
       "thal": 3
     }'</p>
<p>Ожидаемый ответ:</p>
<p>{
  "item_id": 1,
  "prediction": 0.924144415526309,
  "status": "success"
}</p>
<h2>3. Документация API</h2>
<p>После запуска сервиса доступна автоматическая документация:</p>
<ul>
    <li>Swagger UI: http://localhost:8001/docs</li>
    <li>ReDoc: http://localhost:8001/redoc</li>
</ul>
<h2>Особенности реализации</h2>
<ul>
    <li>Поддержка загрузки моделей из локальных файлов (.pkl)</li>
    <li>Интеграция с MLflow для управления моделями</li>
    <li>Валидация входных данных через Pydantic схемы</li>
    <li>Логирование всех операций</li>
    <li>Обработка ошибок и исключительных ситуаций</li>
</ul>